{% extends 'base.html.twig' %}

{% block title %}Hello MessageController!{% endblock %}
{% block javascripts %}
    <script src="{{ asset('js/message_inbox.js') }}" defer></script>
{% endblock %}

{% block body %}
    <main id="message_sent">
    <h1>Messages envoyés</h1>

        <nav class="inbox-nav">
            <ul>
                <li><a href="{{ path('messages_inbox') }}">📥 Boite de recéption</a></li>
                <li><a href="{{ path('message_send') }}">✉️ Nouveau message</a></li>
                <li><a href="{{ path('messages_favorite') }}">❤️ Messages favoris</a></li>
            </ul>
        </nav>
        <section class="message-list">
    <ul>
        {% for message in messages %}
            <li class="message-item"  data-message-id="{{ message.id }}">
                <a href="{{ path('message_view', {
                    'id': message.id,
                    'read': 0
                }) }}">
                    <p>À : {% if message.sender.name == message.lastsender%}
                            {{ message.recipient.name }}
                        {% elseif message.recipient.name == message.lastsender %}
                            {{ message.sender.name }}
                        {% endif %}</p>
                    <p>{{ message.subject ?: 'Sans sujet' }}</p>
                    <small>(Dernier message: {{ message.modifyAt|date('d/m/Y H:i') }})</small>
                </a>
                <div>
                <button class="favorite-toggle">
                    {{ app.user.favorite.contains(message) ? '❤️' : '🤍' }}
                </button>
                <button
                        class="delete-button"
                        data-id="{{ message.id }}"
                        data-csrf="{{ csrf_token('delete' ~ message.id) }}"
                        aria-label="Supprimer le message">🗑️</button>
                </div>
            </li>
        {% else %}
            <li>Aucune conversation.</li>
        {% endfor %}
    </ul>
        </section>
        <div class="pagination">
            {{ knp_pagination_render(messages) }}
        </div>

    </main>

{% endblock %}
